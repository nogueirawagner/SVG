@{
    Layout = "_LayoutBi";
    ViewData["Title"] = "BI / Adesão SVG";
}

<div class="container mt-4">
    @Html.Partial("_GraficoSvg")
</div>

@section Scripts {
    <script>
        let chartSvg;

        document.addEventListener("bi:changed", async () => {

            const qs = buildBiQuery();

            const dados = await fetch(`/api/bi/adesao-svg?${qs}`)
                .then(r => r.json());

            if (chartSvg) chartSvg.destroy();

            chartSvg = new Chart(
                document.getElementById("graficoSvg"),
                {
                    type: "bar",
                    data: {
                        labels: dados.map(d => d.label),
                        datasets: [{
                            label: "SVG",
                            data: dados.map(d => d.total)
                        }]
                    }
                }
            );
        });
    </script>
}
